# åç«¯æ¶æ„è§„åˆ’ - è½»åç«¯ + æœ¬åœ°ä¼˜å…ˆ

> æ ¸å¿ƒç†å¿µï¼š**Local-First**ï¼Œå‰ç«¯æœ¬åœ°å­˜å‚¨ä¸ºä¸»ï¼Œåç«¯ä»…åšæ•°æ®åŒæ­¥ä¸å¢å€¼æœåŠ¡

---

## 1. æ¶æ„æ¦‚è¿°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        å®¢æˆ·ç«¯ (Web/Mobile/å°ç¨‹åº)                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ æœ¬åœ°å­˜å‚¨     â”‚  â”‚ ç¦»çº¿é˜Ÿåˆ—     â”‚  â”‚ åŒæ­¥å¼•æ“               â”‚  â”‚
â”‚  â”‚ IndexedDB   â”‚  â”‚ Pending Ops â”‚  â”‚ Conflict Resolution    â”‚  â”‚
â”‚  â”‚ SQLite      â”‚  â”‚             â”‚  â”‚                        â”‚  â”‚
â”‚  â”‚ AsyncStorageâ”‚  â”‚             â”‚  â”‚                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ åŒæ­¥ (ä»…åœ¨æœ‰ç½‘ç»œæ—¶)
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        è½»åç«¯æœåŠ¡                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ è®¤è¯æœåŠ¡     â”‚  â”‚ æ•°æ®åŒæ­¥     â”‚  â”‚ å¢å€¼æœåŠ¡               â”‚  â”‚
â”‚  â”‚ JWT/OAuth  â”‚  â”‚ CRDT/OT    â”‚  â”‚ - å¹´åº¦æ€»ç»“ç”Ÿæˆ          â”‚  â”‚
â”‚  â”‚             â”‚  â”‚             â”‚  â”‚ - æ¯æ—¥ä¿¡æ¯å·®            â”‚  â”‚
â”‚  â”‚             â”‚  â”‚             â”‚  â”‚ - æ­»äº¡ç¡®è®¤é‚®ä»¶          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. æœ¬åœ°ä¼˜å…ˆç­–ç•¥

### 2.1 å‰ç«¯æœ¬åœ°å®Œæˆçš„åŠŸèƒ½

| åŠŸèƒ½æ¨¡å— | æœ¬åœ°å®ç° | è¯´æ˜ |
|---------|---------|------|
| **æ‰“å¡** | âœ… å®Œå…¨æœ¬åœ° | æœ¬åœ°å­˜å‚¨æ‰“å¡è®°å½•ï¼Œç¦»çº¿å¯ç”¨ |
| **æ‰“å¡ç»Ÿè®¡** | âœ… å®Œå…¨æœ¬åœ° | æœ¬åœ°è®¡ç®—æ€»å¤©æ•°ã€è¿ç»­æ‰“å¡ç­‰ |
| **äººç‰©æ¡£æ¡ˆ** | âœ… å®Œå…¨æœ¬åœ° | CRUD å…¨éƒ¨æœ¬åœ°å®Œæˆ |
| **ç”Ÿæ—¥æé†’** | âœ… å®Œå…¨æœ¬åœ° | æœ¬åœ°è®¡ç®—ä»Šæ—¥ç”Ÿæ—¥ |
| **æ‰“å¡æ—¥å†** | âœ… å®Œå…¨æœ¬åœ° | æœ¬åœ°æ¸²æŸ“æ—¥å†æ•°æ® |
| **æœç´¢è¿‡æ»¤** | âœ… å®Œå…¨æœ¬åœ° | äººç‰©æœç´¢ã€è®°å½•ç­›é€‰ |
| **æ‰“å¡æé†’** | âœ… å®Œå…¨æœ¬åœ° | æœ¬åœ°é€šçŸ¥ / ç³»ç»Ÿé—¹é’Ÿ |
| **ç”¨æˆ·è®¾ç½®** | âœ… å®Œå…¨æœ¬åœ° | æé†’æ—¶é—´ã€ä¸»é¢˜ç­‰ |

### 2.2 æœ¬åœ°å­˜å‚¨æ–¹æ¡ˆ

```typescript
// ç»Ÿä¸€å­˜å‚¨æ¥å£
interface LocalStorage {
  // åŸºç¡€ CRUD
  get<T>(key: string): Promise<T | null>;
  set<T>(key: string, value: T): Promise<void>;
  delete(key: string): Promise<void>;

  // æ‰¹é‡æ“ä½œ
  getAll<T>(prefix: string): Promise<T[]>;

  // æŸ¥è¯¢
  query<T>(collection: string, filter: QueryFilter): Promise<T[]>;
}

// å„å¹³å°å®ç°
// Web: IndexedDB (Dexie.js)
// Mobile: SQLite (expo-sqlite) æˆ– MMKV
// å°ç¨‹åº: wx.getStorage + æœ¬åœ°æ•°æ®åº“
```

### 2.3 æ•°æ®ç»“æ„ (æœ¬åœ°)

```typescript
// æ‰“å¡è®°å½•
interface LocalCheckin {
  id: string;           // uuid
  date: string;         // YYYY-MM-DD
  content?: string;     // æœ‰æ„ä¹‰çš„äº‹
  photo?: string;       // æœ¬åœ°å›¾ç‰‡è·¯å¾„æˆ– base64
  createdAt: number;    // timestamp
  updatedAt: number;
  syncStatus: 'pending' | 'synced' | 'conflict';
  syncedAt?: number;
}

// äººç‰©æ¡£æ¡ˆ
interface LocalPerson {
  id: string;
  name: string;
  gender?: 'male' | 'female' | 'other';
  birthday?: string;    // MM-DD
  birthYear?: number;
  photo?: string;       // æœ¬åœ°è·¯å¾„
  mbti?: string;
  impression?: string;
  experience?: string;
  createdAt: number;
  updatedAt: number;
  syncStatus: 'pending' | 'synced' | 'conflict';
}

// ç”¨æˆ·è®¾ç½® (ä»…æœ¬åœ°)
interface LocalSettings {
  reminderEnabled: boolean;
  reminderTime: string;  // HH:mm
  theme: 'light' | 'dark' | 'system';
  // ä¸éœ€è¦åŒæ­¥çš„æœ¬åœ°åå¥½
}
```

---

## 3. åç«¯æœåŠ¡è®¾è®¡

### 3.1 æœåŠ¡èŒè´£åˆ’åˆ†

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         åç«¯æœåŠ¡                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   åŸºç¡€æœåŠ¡       â”‚   åŒæ­¥æœåŠ¡       â”‚   å¢å€¼æœåŠ¡ (æ ¸å¿ƒä»·å€¼)        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ ç”¨æˆ·æ³¨å†Œ/ç™»å½•  â”‚ â€¢ æ•°æ®ä¸Šä¼        â”‚ â€¢ ğŸŒŸ å¹´åº¦æ€»ç»“ç”Ÿæˆ            â”‚
â”‚ â€¢ Token ç®¡ç†    â”‚ â€¢ æ•°æ®ä¸‹è½½       â”‚ â€¢ ï¿½ï¿½ æ¯æ—¥ä¿¡æ¯å·®              â”‚
â”‚ â€¢ è´¦å·å…³è”      â”‚ â€¢ å†²çªæ£€æµ‹       â”‚ â€¢ ğŸ“§ æ­»äº¡ç¡®è®¤é‚®ä»¶            â”‚
â”‚                â”‚ â€¢ å¢é‡åŒæ­¥       â”‚ â€¢ ğŸ“Š é«˜çº§æ•°æ®åˆ†æ            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       å¿…éœ€               å¯é€‰                ä»˜è´¹/æ ¸å¿ƒ
```

### 3.2 API è®¾è®¡

#### 3.2.1 è®¤è¯æ¥å£ (å¿…éœ€)

```
POST /api/auth/register     # æ³¨å†Œ
POST /api/auth/login        # ç™»å½•
POST /api/auth/refresh      # åˆ·æ–° Token
DELETE /api/auth/logout     # ç™»å‡º
```

#### 3.2.2 åŒæ­¥æ¥å£

```
# é€šç”¨åŒæ­¥æ¥å£ - ç®€åŒ–è®¾è®¡
POST /api/sync/push         # ä¸Šä¼ æœ¬åœ°å˜æ›´
POST /api/sync/pull         # æ‹‰å–è¿œç¨‹å˜æ›´
GET  /api/sync/status       # è·å–åŒæ­¥çŠ¶æ€

# è¯·æ±‚ä½“ç¤ºä¾‹
POST /api/sync/push
{
  "lastSyncAt": 1705123456000,
  "changes": [
    {
      "collection": "checkins",
      "operation": "upsert",  // upsert | delete
      "data": { ... },
      "localUpdatedAt": 1705123456000
    }
  ]
}

# å“åº”ä½“
{
  "syncedAt": 1705123460000,
  "conflicts": [],  // å†²çªè®°å½•ï¼Œç”±å®¢æˆ·ç«¯å†³å®šå¦‚ä½•å¤„ç†
  "accepted": ["id1", "id2"]
}
```

#### 3.2.3 å¢å€¼æœåŠ¡æ¥å£

```
# å¹´åº¦æ€»ç»“
GET  /api/premium/yearly-summary/:year
POST /api/premium/yearly-summary/generate

# æ¯æ—¥ä¿¡æ¯å·®
GET  /api/daily-info                    # è·å–ä»Šæ—¥ä¿¡æ¯å·®
GET  /api/daily-info/history            # å†å²ä¿¡æ¯å·®

# æ­»äº¡ç¡®è®¤
PUT  /api/emergency/config              # æ›´æ–°é…ç½®
POST /api/emergency/test                # æµ‹è¯•å‘é€é‚®ä»¶
```

---

## 4. å¢å€¼æœåŠ¡è¯¦ç»†è®¾è®¡

### 4.1 å¹´åº¦æ€»ç»“ç”Ÿæˆ

#### åŠŸèƒ½æè¿°
åŸºäºç”¨æˆ·ä¸€æ•´å¹´çš„æ‰“å¡æ•°æ®å’Œäººç‰©è®°å½•ï¼Œä½¿ç”¨ AI ç”Ÿæˆä¸ªæ€§åŒ–çš„å¹´åº¦æ€»ç»“æŠ¥å‘Šã€‚

#### æ•°æ®è¾“å…¥
```typescript
interface YearlySummaryInput {
  year: number;
  checkins: {
    totalDays: number;
    maxStreak: number;
    monthlyDistribution: number[];  // 12ä¸ªæœˆçš„æ‰“å¡å¤©æ•°
    meaningfulEvents: string[];     // æœ‰æ„ä¹‰çš„äº‹è®°å½•
    photos: string[];               // ç…§ç‰‡ URL
  };
  people: {
    newAdded: number;               // æ–°å¢äººç‰©æ•°
    birthdays: string[];            // è®°å½•çš„ç”Ÿæ—¥
    topImpressions: string[];       // é«˜é¢‘å°è±¡è¯
  };
}
```

#### è¾“å‡ºæ ¼å¼
```typescript
interface YearlySummary {
  year: number;
  title: string;                    // AI ç”Ÿæˆçš„æ ‡é¢˜
  highlights: string[];             // å¹´åº¦äº®ç‚¹ (3-5æ¡)
  statistics: {
    totalDays: number;
    longestStreak: number;
    meaningfulMoments: number;
    peopleCherished: number;
  };
  monthlyReview: {
    month: number;
    summary: string;                // AI ç”Ÿæˆçš„æœˆåº¦å°ç»“
    keyMoment?: string;
  }[];
  aiInsights: string;               // AI æ´å¯Ÿä¸ç¥ç¦
  shareImage?: string;              // å¯åˆ†äº«çš„å›¾ç‰‡ URL
}
```

#### æŠ€æœ¯å®ç°
```
1. å®¢æˆ·ç«¯è¯·æ±‚ç”Ÿæˆ â†’
2. åç«¯æ”¶é›†è¯¥ç”¨æˆ·å¹´åº¦æ•°æ® â†’
3. è°ƒç”¨ AI API (Claude/GPT) ç”Ÿæˆæ–‡æ¡ˆ â†’
4. ç¼“å­˜ç»“æœ â†’
5. è¿”å›ç»™å®¢æˆ·ç«¯
```

### 4.2 æ¯æ—¥ä¿¡æ¯å·®

#### åŠŸèƒ½æè¿°
æ¯å¤©æ±‡æ€»å½“å¤©ä¸–ç•Œå„åœ°å‘ç”Ÿçš„é‡è¦æ–°é—»äº‹ä»¶ï¼Œå¸®åŠ©ç”¨æˆ·å¿«é€Ÿäº†è§£"ä¿¡æ¯å·®"ï¼ŒåŒæ—¶æ¨é€å†å²ä¸Šçš„ä»Šå¤©ã€‚

**æ ¸å¿ƒä»·å€¼**: è®©ç”¨æˆ·åœ¨æ‰“å¡çš„åŒæ—¶ï¼Œç”¨ 2 åˆ†é’Ÿäº†è§£ä»Šå¤©å‘ç”Ÿäº†ä»€ä¹ˆï¼Œé¿å…ä¿¡æ¯èŒ§æˆ¿ã€‚

#### æ•°æ®ç»“æ„
```typescript
// æ¯æ—¥ä¿¡æ¯å·®
interface DailyInfo {
  id: string;
  date: string;                     // YYYY-MM-DD

  // ä»Šæ—¥æ–°é—» (10æ¡å·¦å³)
  news: DailyNewsItem[];

  // å†å²ä¸Šçš„ä»Šå¤© (3-5æ¡)
  historyToday: HistoryItem[];

  generatedAt: string;              // ç”Ÿæˆæ—¶é—´
}

// æ–°é—»æ¡ç›®
interface DailyNewsItem {
  id: string;
  title: string;                    // æ–°é—»æ ‡é¢˜
  summary: string;                  // ä¸€å¥è¯æ‘˜è¦ (50å­—ä»¥å†…)
  category: 'tech' | 'world' | 'finance' | 'science' | 'culture' | 'sports' | 'other';
  source?: string;                  // æ¥æº
  url?: string;                     // åŸæ–‡é“¾æ¥ (å¯é€‰)
  importance: 1 | 2 | 3;            // é‡è¦ç¨‹åº¦ 1-3
}

// å†å²ä¸Šçš„ä»Šå¤©
interface HistoryItem {
  year: number;                     // å¹´ä»½
  event: string;                    // äº‹ä»¶æè¿°
  category: 'history' | 'birth' | 'death' | 'invention' | 'culture';
}
```

#### å†…å®¹æ¥æºä¸ç”Ÿæˆæµç¨‹
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ¯æ—¥ä¿¡æ¯å·®ç”Ÿæˆæµç¨‹                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  1. å®šæ—¶ä»»åŠ¡ (æ¯å¤© 6:00 + 12:00 + 18:00)                         â”‚
â”‚     â”‚                                                           â”‚
â”‚     â–¼                                                           â”‚
â”‚  2. æ•°æ®é‡‡é›†                                                     â”‚
â”‚     â”œâ”€â”€ æ–°é—» API (NewsAPI / èšåˆæ•°æ® / RSSHub)                   â”‚
â”‚     â”œâ”€â”€ å†å²ä¸Šçš„ä»Šå¤© API                                         â”‚
â”‚     â””â”€â”€ è‡ªå®šä¹‰æ•°æ®æº                                             â”‚
â”‚     â”‚                                                           â”‚
â”‚     â–¼                                                           â”‚
â”‚  3. AI å¤„ç† (Claude/GPT)                                        â”‚
â”‚     â”œâ”€â”€ ç­›é€‰é‡è¦æ–°é—» (å»é‡ã€è¿‡æ»¤ä½è´¨é‡)                           â”‚
â”‚     â”œâ”€â”€ ç”Ÿæˆä¸­æ–‡æ‘˜è¦                                             â”‚
â”‚     â”œâ”€â”€ åˆ†ç±»æ ‡ç­¾                                                â”‚
â”‚     â””â”€â”€ é‡è¦æ€§è¯„åˆ†                                               â”‚
â”‚     â”‚                                                           â”‚
â”‚     â–¼                                                           â”‚
â”‚  4. å­˜å‚¨ & ç¼“å­˜                                                  â”‚
â”‚     â””â”€â”€ æŒ‰æ—¥æœŸå­˜å‚¨ï¼Œå®¢æˆ·ç«¯ç›´æ¥æ‹‰å–                                â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æ–°é—»åˆ†ç±»è¯´æ˜
| åˆ†ç±» | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `tech` | ç§‘æŠ€äº’è”ç½‘ | AI çªç ´ã€äº§å“å‘å¸ƒã€å…¬å¸åŠ¨æ€ |
| `world` | å›½é™…æ—¶äº‹ | æ”¿æ²»ã€å¤–äº¤ã€ç¤¾ä¼šäº‹ä»¶ |
| `finance` | è´¢ç»é‡‘è | è‚¡å¸‚ã€åŠ å¯†è´§å¸ã€ç»æµæ”¿ç­– |
| `science` | ç§‘å­¦å‘ç° | å­¦æœ¯çªç ´ã€å¤ªç©ºæ¢ç´¢ |
| `culture` | æ–‡åŒ–å¨±ä¹ | ç”µå½±ã€éŸ³ä¹ã€è‰ºæœ¯ |
| `sports` | ä½“è‚²èµ›äº‹ | é‡å¤§æ¯”èµ›ã€è¿åŠ¨å‘˜æ–°é—» |

#### API å®ç°
```typescript
// è·å–ä»Šæ—¥ä¿¡æ¯å·®
GET /api/daily-info
Response: {
  "date": "2025-01-15",
  "news": [
    {
      "id": "n1",
      "title": "OpenAI å‘å¸ƒ GPT-5",
      "summary": "æ–°æ¨¡å‹åœ¨æ¨ç†èƒ½åŠ›ä¸Šæœ‰é‡å¤§çªç ´ï¼Œå¯å¤„ç†æ›´å¤æ‚çš„å¤šæ­¥éª¤ä»»åŠ¡",
      "category": "tech",
      "source": "TechCrunch",
      "importance": 3
    },
    {
      "id": "n2",
      "title": "æ¬§ç›Ÿé€šè¿‡æ–° AI ç›‘ç®¡æ³•æ¡ˆ",
      "summary": "å…¨çƒé¦–ä¸ªå…¨é¢çš„ AI ç›‘ç®¡æ¡†æ¶ï¼Œå°†äº 2025 å¹´åº•ç”Ÿæ•ˆ",
      "category": "world",
      "importance": 2
    }
    // ... å…± 10 æ¡
  ],
  "historyToday": [
    {
      "year": 2001,
      "event": "ç»´åŸºç™¾ç§‘æ­£å¼ä¸Šçº¿",
      "category": "invention"
    },
    {
      "year": 1929,
      "event": "é©¬ä¸Â·è·¯å¾·Â·é‡‘å‡ºç”Ÿ",
      "category": "birth"
    }
    // ... å…± 3-5 æ¡
  ],
  "generatedAt": "2025-01-15T06:00:00Z"
}

// é«˜çº§å®ç°ï¼šä¸ªæ€§åŒ–æ¨è
GET /api/daily-info?personalized=true
// åŸºäºç”¨æˆ·æ‰“å¡é¢‘ç‡ã€è®°å½•å†…å®¹ç­‰ç”Ÿæˆä¸ªæ€§åŒ–å†…å®¹
```

### 4.3 æ­»äº¡ç¡®è®¤é‚®ä»¶

#### è§¦å‘é€»è¾‘
```typescript
// å®šæ—¶ä»»åŠ¡ (æ¯å¤©è¿è¡Œä¸€æ¬¡)
async function checkDeathConfirmation() {
  const configs = await db.emergencyConfig.findMany({
    where: { isEnabled: true }
  });

  for (const config of configs) {
    const lastCheckin = await getLastCheckin(config.userId);
    const daysSinceLastCheckin = diffDays(new Date(), lastCheckin.date);

    if (daysSinceLastCheckin >= config.triggerDays) {
      // æ£€æŸ¥æ˜¯å¦å·²å‘é€è¿‡
      if (!hasNotifiedRecently(config)) {
        await sendDeathConfirmationEmail(config);
        await updateLastNotifiedAt(config);
      }
    }
  }
}
```

#### é‚®ä»¶æ¨¡æ¿
```html
ä¸»é¢˜: ã€ä»Šå¤©åˆæ´»äº†ä¸€å¤©ã€‘å…³äº {{nickname}} çš„ç”Ÿå­˜ç¡®è®¤

äº²çˆ±çš„æœ‹å‹ï¼š

è¿™å°é‚®ä»¶æ¥è‡ª"ä»Šå¤©åˆæ´»äº†ä¸€å¤©"åº”ç”¨ã€‚

{{nickname}} å·²ç» {{days}} å¤©æ²¡æœ‰ç¡®è®¤å­˜æ´»çŠ¶æ€äº†ã€‚

è¿™å¯èƒ½æ„å‘³ç€ï¼š
- Ta åªæ˜¯å¿˜è®°äº†æ‰“å¡
- Ta æœ€è¿‘å¾ˆå¿™
- æˆ–è€…...éœ€è¦æ‚¨ç¡®è®¤ä¸€ä¸‹ Ta çš„çŠ¶å†µ

å¦‚æœæ‚¨æ”¶åˆ°è¿™å°é‚®ä»¶ï¼Œå»ºè®®è”ç³» {{nickname}} ç¡®è®¤ä¸€ä¸‹æƒ…å†µã€‚

---
è¿™æ˜¯ä¸€å°è‡ªåŠ¨å‘é€çš„é‚®ä»¶ï¼Œç”± {{nickname}} é¢„å…ˆè®¾ç½®ã€‚
```

---

## 5. æ•°æ®åŒæ­¥ç­–ç•¥

### 5.1 åŒæ­¥æ—¶æœº

```typescript
// åŒæ­¥è§¦å‘æ¡ä»¶
const SyncTriggers = {
  // è‡ªåŠ¨åŒæ­¥
  APP_FOREGROUND: true,      // åº”ç”¨è¿›å…¥å‰å°
  NETWORK_RESTORED: true,    // ç½‘ç»œæ¢å¤
  PERIODIC: '30min',         // å®šæœŸåŒæ­¥ (åå°)

  // æ‰‹åŠ¨åŒæ­¥
  USER_TRIGGERED: true,      // ç”¨æˆ·æ‰‹åŠ¨è§¦å‘
  BEFORE_LOGOUT: true,       // ç™»å‡ºå‰
};
```

### 5.2 å†²çªè§£å†³

```typescript
// Last-Write-Wins ç­–ç•¥ (ç®€å•åœºæ™¯)
function resolveConflict(local: Record, remote: Record): Record {
  return local.updatedAt > remote.updatedAt ? local : remote;
}

// æˆ–è€…è®©ç”¨æˆ·é€‰æ‹©
interface ConflictResolution {
  conflictId: string;
  localVersion: Record;
  remoteVersion: Record;
  resolution: 'keep_local' | 'keep_remote' | 'merge';
}
```

### 5.3 å¢é‡åŒæ­¥

```typescript
// åªåŒæ­¥å˜æ›´çš„æ•°æ®
POST /api/sync/push
{
  "lastSyncAt": 1705123456000,  // ä¸Šæ¬¡åŒæ­¥æ—¶é—´æˆ³
  "changes": [
    // åªåŒ…å« updatedAt > lastSyncAt çš„è®°å½•
  ]
}
```

---

## 6. æ•°æ®åº“è®¾è®¡ (åç«¯)

### 6.1 ç²¾ç®€çš„è¡¨ç»“æ„

```prisma
// ç”¨æˆ·è¡¨ - ä»…å­˜å‚¨è®¤è¯ä¿¡æ¯
model User {
  id            String   @id @default(uuid())
  email         String   @unique
  password      String
  nickname      String?
  createdAt     DateTime @default(now())

  // å…³è”
  syncData      SyncData?
  emergency     EmergencyConfig?
}

// åŒæ­¥æ•°æ® - å­˜å‚¨ç”¨æˆ·çš„å…¨éƒ¨åŒæ­¥æ•°æ®
model SyncData {
  id            String   @id @default(uuid())
  userId        String   @unique
  user          User     @relation(fields: [userId], references: [id])

  // JSON å­˜å‚¨æ‰€æœ‰æ•°æ® (ç®€åŒ–è®¾è®¡)
  checkins      Json     @default("[]")
  people        Json     @default("[]")

  lastSyncAt    DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

// ç´§æ€¥é…ç½®
model EmergencyConfig {
  id            String   @id @default(uuid())
  userId        String   @unique
  user          User     @relation(fields: [userId], references: [id])

  email         String
  triggerDays   Int      @default(7)
  isEnabled     Boolean  @default(false)
  lastNotifiedAt DateTime?
}

// æ¯æ—¥ä¿¡æ¯å·® (åå°ç®¡ç†)
model DailyInfo {
  id            String   @id @default(uuid())
  date          String   @unique  // YYYY-MM-DD
  type          String
  content       Json
  tags          String[]
  createdAt     DateTime @default(now())
}

// å¹´åº¦æ€»ç»“ç¼“å­˜
model YearlySummary {
  id            String   @id @default(uuid())
  userId        String
  year          Int
  content       Json
  generatedAt   DateTime @default(now())

  @@unique([userId, year])
}
```

---

## 7. æŠ€æœ¯æ ˆå»ºè®®

### 7.1 åç«¯æŠ€æœ¯æ ˆ

```
æ¡†æ¶:      Fastify (ç°æœ‰) æˆ– Hono (æ›´è½»é‡)
æ•°æ®åº“:    PostgreSQL + Prisma
ç¼“å­˜:      Redis (å¯é€‰ï¼Œç”¨äºæ¯æ—¥ä¿¡æ¯å·®ç¼“å­˜)
å®šæ—¶ä»»åŠ¡:  node-cron æˆ– BullMQ
é‚®ä»¶:      nodemailer + é‚®ä»¶æ¨¡æ¿
AI:       Claude API æˆ– OpenAI API (å¹´åº¦æ€»ç»“)
éƒ¨ç½²:      Vercel / Railway / Fly.io (Serverless å‹å¥½)
```

### 7.2 å‰ç«¯æœ¬åœ°å­˜å‚¨

```
Web:        IndexedDB (Dexie.js)
Mobile:     expo-sqlite æˆ– @react-native-async-storage/async-storage
å°ç¨‹åº:     wx.getStorage + æœ¬åœ°è®¡ç®—
```

---

## 8. å®ç°è·¯çº¿å›¾

### Phase 1: æœ¬åœ°ä¼˜å…ˆåŸºç¡€ (1å‘¨)

```
[ ] å®ç°æœ¬åœ°å­˜å‚¨å±‚
    [ ] Web: IndexedDB å°è£…
    [ ] Mobile: SQLite/MMKV å°è£…
    [ ] ç»Ÿä¸€å­˜å‚¨æ¥å£
[ ] å‰ç«¯æ‰€æœ‰åŠŸèƒ½æœ¬åœ°åŒ–
    [ ] æ‰“å¡åŠŸèƒ½å®Œå…¨æœ¬åœ°
    [ ] äººç‰©ç®¡ç†å®Œå…¨æœ¬åœ°
    [ ] ç»Ÿè®¡è®¡ç®—æœ¬åœ°å®Œæˆ
[ ] ç¦»çº¿çŠ¶æ€å¤„ç†
```

### Phase 2: è½»åç«¯æœåŠ¡ (1å‘¨)

```
[ ] ç²¾ç®€åç«¯ API
    [ ] è®¤è¯æ¥å£
    [ ] åŒæ­¥æ¥å£ (push/pull)
[ ] æ•°æ®åº“è¿ç§»
    [ ] ç®€åŒ–è¡¨ç»“æ„
    [ ] SyncData JSON å­˜å‚¨
[ ] åŒæ­¥å¼•æ“
    [ ] å¢é‡åŒæ­¥
    [ ] å†²çªæ£€æµ‹
```

### Phase 3: å¢å€¼æœåŠ¡ (2å‘¨)

```
[ ] æ¯æ—¥ä¿¡æ¯å·®
    [ ] å†…å®¹åº“å»ºè®¾
    [ ] API å®ç°
    [ ] å‰ç«¯å±•ç¤º
[ ] å¹´åº¦æ€»ç»“
    [ ] AI ç”Ÿæˆé€»è¾‘
    [ ] æ¨¡æ¿è®¾è®¡
    [ ] åˆ†äº«å›¾ç‰‡ç”Ÿæˆ
[ ] æ­»äº¡ç¡®è®¤é‚®ä»¶
    [ ] å®šæ—¶ä»»åŠ¡
    [ ] é‚®ä»¶æ¨¡æ¿
    [ ] æµ‹è¯•å‘é€
```

---

## 9. æˆæœ¬ä¼°ç®—

### 9.1 æœåŠ¡å™¨æˆæœ¬ (è½»åç«¯ä¼˜åŠ¿)

| æœåŠ¡ | æ–¹æ¡ˆ | é¢„ä¼°æˆæœ¬/æœˆ |
|------|------|------------|
| åç«¯æ‰˜ç®¡ | Vercel/Railway Free Tier | $0 |
| æ•°æ®åº“ | Supabase/PlanetScale Free | $0 |
| é‚®ä»¶ | Resend (100å°/å¤©å…è´¹) | $0 |
| AI API | Claude/OpenAI (æŒ‰éœ€) | $5-20 |

**æ€»è®¡: $0-20/æœˆ** (å°è§„æ¨¡ç”¨æˆ·)

### 9.2 å¯¹æ¯”ä¼ ç»Ÿåç«¯

```
ä¼ ç»Ÿé‡åç«¯:
- éœ€è¦æŒç»­è¿è¡Œçš„æœåŠ¡å™¨: $20+/æœˆ
- å®æ—¶æ•°æ®åº“è¿æ¥: é«˜èµ„æºå ç”¨
- æ¯ä¸ªè¯·æ±‚éƒ½ç»è¿‡åç«¯: é«˜æµé‡æˆæœ¬

è½»åç«¯ + æœ¬åœ°ä¼˜å…ˆ:
- Serverless æŒ‰éœ€è®¡è´¹: ä½æˆæœ¬
- æœ¬åœ°å­˜å‚¨å‡å°‘ 90% è¯·æ±‚
- åŒæ­¥åªåœ¨éœ€è¦æ—¶å‘ç”Ÿ
```

---

## 10. æ€»ç»“

### æ ¸å¿ƒåŸåˆ™

1. **æœ¬åœ°ä¼˜å…ˆ**: æ‰€æœ‰åŸºç¡€åŠŸèƒ½ç¦»çº¿å¯ç”¨
2. **æŒ‰éœ€åŒæ­¥**: åªåœ¨éœ€è¦æ—¶æ‰è¿æ¥æœåŠ¡å™¨
3. **å¢å€¼æœåŠ¡**: åç«¯ä¸“æ³¨äº AI ç”Ÿæˆã€é‚®ä»¶ç­‰æ— æ³•æœ¬åœ°å®Œæˆçš„åŠŸèƒ½
4. **ä½æˆæœ¬**: Serverless + ç²¾ç®€è®¾è®¡ï¼Œé€‚åˆç‹¬ç«‹å¼€å‘è€…

### åç«¯èŒè´£è¾¹ç•Œ

```
âœ… åç«¯è´Ÿè´£:
   - ç”¨æˆ·è®¤è¯
   - è·¨è®¾å¤‡æ•°æ®åŒæ­¥
   - AI å¹´åº¦æ€»ç»“ç”Ÿæˆ
   - æ¯æ—¥ä¿¡æ¯å·®å†…å®¹
   - æ­»äº¡ç¡®è®¤é‚®ä»¶

âŒ åç«¯ä¸è´Ÿè´£:
   - æ‰“å¡é€»è¾‘
   - ç»Ÿè®¡è®¡ç®—
   - äººç‰©ç®¡ç†
   - æœ¬åœ°é€šçŸ¥
   - UI çŠ¶æ€
```

è¿™æ ·çš„æ¶æ„è®©åº”ç”¨å³ä½¿å®Œå…¨ç¦»çº¿ä¹Ÿèƒ½æ­£å¸¸ä½¿ç”¨ï¼Œåç«¯åªæ˜¯é”¦ä¸Šæ·»èŠ±çš„å¢å¼ºæœåŠ¡ã€‚
