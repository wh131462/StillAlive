generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// 用户表
model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  nickname  String?
  avatar    String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // 关联
  checkins        Checkin[]
  people          Person[]
  emergencyConfig EmergencyConfig?

  @@map("users")
}

// 打卡记录表
model Checkin {
  id        String   @id @default(cuid())
  userId    String
  date      DateTime @db.Date
  content   String?  // 有意义的事
  photo     String?  // 今日照片URL
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, date])
  @@map("checkins")
}

// 人物表
model Person {
  id         String   @id @default(cuid())
  userId     String
  name       String
  gender     String?  // male, female, other
  birthday   String?  // MM-DD 格式
  birthYear  Int?     // 出生年份(可选)
  photo      String?
  mbti       String?
  impression String?  // 个人印象
  experience String?  // 共同经历
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("people")
}

// 紧急联系人配置(死亡确认)
model EmergencyConfig {
  id             String   @id @default(cuid())
  userId         String   @unique
  email          String   // 紧急联系人邮箱
  triggerDays    Int      @default(7) // 触发天数
  isEnabled      Boolean  @default(true)
  lastNotifiedAt DateTime? // 上次通知时间
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("emergency_configs")
}
